<!DOCTYPE html>
<html>
  <title>Markdown preview</title
  ><link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((el) => {
        hljs.highlightElement(el);
      });
    });
  </script>
  <script type="text/javascript">
    var WS_PORT = 8080;
    var WS_URL = 'ws://localhost:'.concat(8080);
    function refreshMd(data) {
      var payload = data.payload;
      var elem = document.querySelector('article.markdown-body');
      if (elem) {
        elem.innerHTML = payload;
      }
      document.querySelectorAll('pre code').forEach((el) => {
        hljs.highlightElement(el);
      });
    }
    var actions = {
      refresh: refreshMd,
    };
    var WSBridge = /** @class */ (function () {
      function WSBridge() {
        this.queue = [];
        this.ws = null;
        this.makeWS = this.makeWS.bind(this);
        this.ws = this.makeWS();
        this.queue = [];
      }
      WSBridge.build = function () {
        return new WSBridge();
      };
      WSBridge.prototype.makeWS = function () {
        var _this = this;
        var ws = new WebSocket(WS_URL);
        console.log('ws:', ws);
        ws.onopen = function () {
          while (_this.queue.length > 0) {
            ws.send(_this.queue.shift());
          }
        };
        ws.onmessage = function (wsMsg) {
          var data = JSON.parse(wsMsg.data);
          var actionType = data.type;
          var handler = actions[actionType];
          if (typeof handler === 'function') {
            handler(data);
          }
        };
        ws.onclose = function (evt) {
          console.log('evt:', {
            type: 'closed',
            payload: { code: evt.code, reason: evt.reason },
          });
        };
        return ws;
      };
      WSBridge.prototype.sendMessage = function (msg) {
        msg = JSON.stringify(msg);
        if (this.ws.readyState === this.ws.CONNECTING) {
          this.queue.push(msg);
        } else if (this.ws.readyState === this.ws.OPEN) {
          this.ws.send(msg);
        }
      };
      return WSBridge;
    })();
    var wsBridge = WSBridge.build();

    document.addEventListener('DOMContentLoaded', (event) => {
      wsBridge.sendMessage('getHtml');
    });
  </script>
  <body>
    <article
      class="markdown-body"
      style="
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
      "
    ></article>
  </body>
</html>
