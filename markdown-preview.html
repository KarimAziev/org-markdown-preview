<!DOCTYPE html>
<html>
  <title>Markdown preview</title
  ><link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((el) => {
        hljs.highlightElement(el);
      });
    });
  </script>
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', (event) => {
      var WS_PORT = 8080;
      var WS_URL = 'ws://localhost:'.concat(WS_PORT);
      function refreshMd(data) {
        var payload = data.payload;
        var elem = document.querySelector('article.markdown-body');
        if (elem) {
          elem.innerHTML = payload;
        }
        document.querySelectorAll('pre code').forEach((el) => {
          hljs.highlightElement(el);
        });
      }
      var actions = {
        refresh: refreshMd,
      };
      var WSBridge = /** @class */ (function () {
        function WSBridge() {}
        WSBridge.prototype.init = function () {
          this.queue = ['getHtml'];
          return this.makeWS(this.queue);
        };
        WSBridge.prototype.makeWS = function (queue) {
          var ws = new WebSocket(WS_URL);
          ws.onopen = function () {
            while (queue.length > 0) {
              var m = queue.shift();
              if (typeof m === 'string') {
                ws.send(m);
              }
            }
          };
          ws.onmessage = function (wsMsg) {
            var data = JSON.parse(wsMsg.data);
            var actionType = data.type;
            var handler = actions[actionType];
            if (typeof handler === 'function') {
              handler(data);
            }
          };
          ws.onclose = function (evt) {
            console.log('websocket closed:', evt);
          };
          return ws;
        };
        WSBridge.prototype.send = function (msg) {
          var payload = JSON.stringify(msg);
          if (this.ws.readyState === this.ws.CONNECTING) {
            this.queue.push(payload);
          } else if (this.ws.readyState === this.ws.OPEN) {
            this.ws.send(payload);
          }
        };
        return WSBridge;
      })();

        var ws = new WSBridge();
        ws.init();
        ws.send('getHtml');
        document.querySelectorAll('pre code').forEach((el) => {
            hljs.highlightElement(el);
      });
    });
  </script>
  <body>
      <article
          class="markdown-body"
          style="
                 box-sizing: border-box;
                 min-width: 200px;
                 max-width: 980px;
                 margin: 0 auto;
                 padding: 45px;
                 "
      ></article>
  </body>
</html>
